<div class="admin-section">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <h3>消息管理</h3>
        <button class="action-btn" style="background-color: rgba(52, 152, 219, 0.7);" onclick="loadContent('admin_home')">返回首页</button>
    </div>
    <p>管理用户留言和系统消息</p>

    <div class="search-container">
        <input type="text" id="message-search" class="search-input" placeholder="搜索消息内容或用户名...">
    </div>

    <div class="tabs">
        <div class="tab active" data-tab="all-messages">全部消息</div>
        <div class="tab" data-tab="unread-messages">未读消息</div>
        <div class="tab" data-tab="flagged-messages">标记消息</div>
    </div>

    <div class="tab-content active" id="all-messages">
        <div class="message-filter" style="display: flex; gap: 10px; margin-bottom: 15px;">
            <select id="filter-type" class="form-control" style="width: auto;">
                <option value="all">所有类型</option>
                <option value="question">问题</option>
                <option value="feedback">反馈</option>
                <option value="suggestion">建议</option>
            </select>
            <select id="filter-date" class="form-control" style="width: auto;">
                <option value="all">所有时间</option>
                <option value="today">今天</option>
                <option value="week">本周</option>
                <option value="month">本月</option>
            </select>
            <button id="batch-delete" class="delete-btn" style="margin-left: auto;">批量删除</button>
        </div>

        <div id="message-list">
            <!-- 消息列表 -->
            <div class="message-item" id="message-1">
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <input type="checkbox" class="message-checkbox" data-id="1" style="margin-right: 10px;">
                    <div style="flex-grow: 1;">
                        <div class="message-header">
                            <span class="message-author">张三</span>
                            <span class="message-time">2023-06-15 14:30</span>
                        </div>
                        <div class="message-content">
                            我想了解更多关于藏红花的功效，有没有最新的研究资料可以分享？
                        </div>
                    </div>
                </div>
                <div class="message-actions" style="display: flex; justify-content: flex-end; gap: 10px;">
                    <button class="action-btn" onclick="flagMessage(1)" style="background-color: rgba(241, 196, 15, 0.7); color: white;">
                        <span id="flag-text-1">标记</span>
                    </button>
                    <button class="reply-btn" data-id="1">回复</button>
                    <button class="delete-message-btn" data-id="1">删除</button>
                </div>
                <div id="reply-form-1" style="display: none; margin-top: 15px;">
                    <textarea class="form-control" placeholder="输入回复内容..." style="width: 100%; height: 80px;"></textarea>
                    <div style="margin-top: 10px;">
                        <button class="submit-btn" onclick="sendReply(1)">发送回复</button>
                        <button class="cancel-btn" onclick="cancelReply(1)">取消</button>
                    </div>
                </div>
            </div>

            <div class="message-item" id="message-2">
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <input type="checkbox" class="message-checkbox" data-id="2" style="margin-right: 10px;">
                    <div style="flex-grow: 1;">
                        <div class="message-header">
                            <span class="message-author">李四</span>
                            <span class="message-time">2023-06-14 09:15</span>
                        </div>
                        <div class="message-content">
                            网站的植物分类功能非常实用，但是搜索功能有时候不太准确，希望能够改进一下。
                        </div>
                    </div>
                </div>
                <div class="message-actions" style="display: flex; justify-content: flex-end; gap: 10px;">
                    <button class="action-btn" onclick="flagMessage(2)" style="background-color: rgba(241, 196, 15, 0.7); color: white;">
                        <span id="flag-text-2">标记</span>
                    </button>
                    <button class="reply-btn" data-id="2">回复</button>
                    <button class="delete-message-btn" data-id="2">删除</button>
                </div>
                <div id="reply-form-2" style="display: none; margin-top: 15px;">
                    <textarea class="form-control" placeholder="输入回复内容..." style="width: 100%; height: 80px;"></textarea>
                    <div style="margin-top: 10px;">
                        <button class="submit-btn" onclick="sendReply(2)">发送回复</button>
                        <button class="cancel-btn" onclick="cancelReply(2)">取消</button>
                    </div>
                </div>
            </div>

            <div class="message-item" id="message-3">
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <input type="checkbox" class="message-checkbox" data-id="3" style="margin-right: 10px;">
                    <div style="flex-grow: 1;">
                        <div class="message-header">
                            <span class="message-author">王五</span>
                            <span class="message-time">2023-06-13 16:45</span>
                        </div>
                        <div class="message-content">
                            我是一名中医学研究生，想知道是否可以为平台贡献一些藏药植物的研究资料？
                        </div>
                    </div>
                </div>
                <div class="message-actions" style="display: flex; justify-content: flex-end; gap: 10px;">
                    <button class="action-btn" onclick="flagMessage(3)" style="background-color: rgba(241, 196, 15, 0.7); color: white;">
                        <span id="flag-text-3">标记</span>
                    </button>
                    <button class="reply-btn" data-id="3">回复</button>
                    <button class="delete-message-btn" data-id="3">删除</button>
                </div>
                <div id="reply-form-3" style="display: none; margin-top: 15px;">
                    <textarea class="form-control" placeholder="输入回复内容..." style="width: 100%; height: 80px;"></textarea>
                    <div style="margin-top: 10px;">
                        <button class="submit-btn" onclick="sendReply(3)">发送回复</button>
                        <button class="cancel-btn" onclick="cancelReply(3)">取消</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="pagination">
            <div class="pagination-btn active">1</div>
            <div class="pagination-btn">2</div>
            <div class="pagination-btn">3</div>
            <div class="pagination-btn">下一页</div>
        </div>
    </div>

    <div class="tab-content" id="unread-messages">
        <p>您没有未读消息。</p>
    </div>

    <div class="tab-content" id="flagged-messages">
        <p>您没有标记的消息。</p>
    </div>
</div>

<script>
    $(document).ready(function() {
        // 初始化标签页切换
        $('.tab').click(function() {
            $('.tab').removeClass('active');
            $(this).addClass('active');
            
            const tabId = $(this).data('tab');
            $('.tab-content').removeClass('active');
            $(`#${tabId}`).addClass('active');
        });

        // 初始化回复按钮
        $('.reply-btn').click(function() {
            const id = $(this).data('id');
            $(`#reply-form-${id}`).slideToggle();
        });

        // 初始化删除按钮
        $('.delete-message-btn').click(function() {
            const id = $(this).data('id');
            deleteMessage(id);
        });

        // 初始化搜索功能
        $('#message-search').on('keyup', function() {
            const value = $(this).val().toLowerCase();
            $('.message-item').filter(function() {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
            });
        });

        // 初始化筛选功能
        $('#filter-type, #filter-date').change(function() {
            filterMessages();
        });

        // 初始化批量删除
        $('#batch-delete').click(function() {
            const selectedIds = [];
            $('.message-checkbox:checked').each(function() {
                selectedIds.push($(this).data('id'));
            });

            if (selectedIds.length === 0) {
                alert('请选择要删除的消息');
                return;
            }

            if (confirm(`确定要删除选中的 ${selectedIds.length} 条消息吗？`)) {
                selectedIds.forEach(id => {
                    $(`#message-${id}`).fadeOut(function() {
                        $(this).remove();
                    });
                });
            }
        });
    });

    // 删除消息
    function deleteMessage(id) {
        if (confirm('确定要删除这条消息吗？')) {
            $(`#message-${id}`).fadeOut(function() {
                $(this).remove();
                checkEmptyMessages();
            });
        }
    }

    // 发送回复
    function sendReply(id) {
        const replyText = $(`#reply-form-${id} textarea`).val();
        if (!replyText.trim()) {
            alert('回复内容不能为空');
            return;
        }

        // 这里可以添加发送回复到后端的逻辑
        alert('回复已发送');
        $(`#reply-form-${id}`).slideUp();
        $(`#reply-form-${id} textarea`).val('');

        // 添加回复到消息下方
        const replyHtml = `
            <div class="message-item" style="margin-left: 30px; background-color: rgba(255, 255, 255, 0.05); margin-top: 10px;">
                <div class="message-header">
                    <span class="message-author">管理员 (回复)</span>
                    <span class="message-time">${new Date().toLocaleString()}</span>
                </div>
                <div class="message-content">${replyText}</div>
            </div>
        `;
        $(`#message-${id}`).append(replyHtml);
    }

    // 取消回复
    function cancelReply(id) {
        $(`#reply-form-${id}`).slideUp();
        $(`#reply-form-${id} textarea`).val('');
    }

    // 标记消息
    function flagMessage(id) {
        const flagText = $(`#flag-text-${id}`).text();
        if (flagText === '标记') {
            $(`#flag-text-${id}`).text('取消标记');
            $(`#message-${id}`).css('border-left', '4px solid #F1C40F');
        } else {
            $(`#flag-text-${id}`).text('标记');
            $(`#message-${id}`).css('border-left', 'none');
        }
    }

    // 筛选消息
    function filterMessages() {
        const typeFilter = $('#filter-type').val();
        const dateFilter = $('#filter-date').val();
        
        // 这里应该有实际的筛选逻辑，这里只是示例
        console.log(`筛选条件: 类型=${typeFilter}, 日期=${dateFilter}`);
        
        // 模拟筛选效果
        if (typeFilter !== 'all' || dateFilter !== 'all') {
            $('.message-item').hide();
            // 显示一些随机消息作为筛选结果
            $('.message-item').slice(0, Math.floor(Math.random() * 3) + 1).show();
        } else {
            $('.message-item').show();
        }
        
        checkEmptyMessages();
    }

    // 检查是否没有消息
    function checkEmptyMessages() {
        if ($('.message-item:visible').length === 0) {
            $('#message-list').html('<p>没有符合条件的消息</p>');
        }
    }
</script>

