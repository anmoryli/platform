<div class="admin-section">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <h3>数据导入导出</h3>
        <button class="action-btn" style="background-color: rgba(52, 152, 219, 0.7);" onclick="loadContent('admin_home')">返回首页</button>
    </div>
    <p>管理系统数据的导入和导出</p>

    <div class="tabs">
        <div class="tab active" data-tab="export-tab">数据导出</div>
        <div class="tab" data-tab="import-tab">数据导入</div>
    </div>

    <div class="tab-content active" id="export-tab">
        <div class="admin-section" style="width: 100%; margin-top: 20px;">
            <h3>导出数据</h3>
            <p>选择要导出的数据类型和格式</p>
            
            <div style="margin-top: 20px;">
                <div class="form-group">
                    <label for="export-data-type">数据类型</label>
                    <select id="export-data-type" class="form-control">
                        <option value="plants">植物数据</option>
                        <option value="users">用户数据</option>
                        <option value="messages">留言数据</option>
                        <option value="all">所有数据</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="export-format">导出格式</label>
                    <select id="export-format" class="form-control">
                        <option value="json">JSON</option>
                        <option value="csv">CSV</option>
                        <option value="excel">Excel</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>导出选项</label>
                    <div style="margin-top: 10px;">
                        <label style="display: flex; align-items: center; color: white; margin-bottom: 10px;">
                            <input type="checkbox" id="include-images" style="margin-right: 10px;"> 包含图片资源
                        </label>
                        <label style="display: flex; align-items: center; color: white;">
                            <input type="checkbox" id="compress-export" style="margin-right: 10px;"> 压缩导出文件
                        </label>
                    </div>
                </div>
                
                <button class="submit-btn" onclick="exportData()">导出数据</button>
            </div>
            
            <div id="export-history" style="margin-top: 30px;">
                <h4 style="color: white; margin-bottom: 15px;">导出历史</h4>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>导出时间</th>
                            <th>数据类型</th>
                            <th>格式</th>
                            <th>文件大小</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>2023-06-10 14:30</td>
                            <td>植物数据</td>
                            <td>JSON</td>
                            <td>2.4 MB</td>
                            <td>
                                <button class="action-btn" style="background-color: rgba(52, 152, 219, 0.7);" onclick="downloadExport('export_20230610_plants.json')">下载</button>
                            </td>
                        </tr>
                        <tr>
                            <td>2023-05-25 09:15</td>
                            <td>所有数据</td>
                            <td>Excel</td>
                            <td>5.7 MB</td>
                            <td>
                                <button class="action-btn" style="background-color: rgba(52, 152, 219, 0.7);" onclick="downloadExport('export_20230525_all.xlsx')">下载</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="tab-content" id="import-tab">
        <div class="admin-section" style="width: 100%; margin-top: 20px;">
            <h3>导入数据</h3>
            <p>选择要导入的数据文件和选项</p>
            
            <div style="margin-top: 20px;">
                <div class="form-group">
                    <label for="import-data-type">数据类型</label>
                    <select id="import-data-type" class="form-control">
                        <option value="plants">植物数据</option>
                        <option value="users">用户数据</option>
                        <option value="messages">留言数据</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="import-file">选择文件</label>
                    <input type="file" id="import-file" class="form-control">
                    <p style="color: rgba(255, 255, 255, 0.7); font-size: 14px; margin-top: 5px;">支持 JSON, CSV, Excel 格式</p>
                </div>
                
                <div class="form-group">
                    <label>导入选项</label>
                    <div style="margin-top: 10px;">
                        <label style="display: flex; align-items: center; color: white; margin-bottom: 10px;">
                            <input type="checkbox" id="overwrite-existing" style="margin-right: 10px;"> 覆盖现有数据
                        </label>
                        <label style="display: flex; align-items: center; color: white;">
                            <input type="checkbox" id="validate-import" style="margin-right: 10px;" checked> 导入前验证数据
                        </label>
                    </div>
                </div>
                
                <button class="submit-btn" onclick="importData()">导入数据</button>
            </div>
            
            <div id="import-history" style="margin-top: 30px;">
                <h4 style="color: white; margin-bottom: 15px;">导入历史</h4>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>导入时间</th>
                            <th>数据类型</th>
                            <th>文件名</th>
                            <th>状态</th>
                            <th>详情</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>2023-06-05 11:20</td>
                            <td>植物数据</td>
                            <td>plants_batch_2.json</td>
                            <td><span style="color: #2ECC71;">成功</span></td>
                            <td>
                                <button class="action-btn" style="background-color: rgba(52, 152, 219, 0.7);" onclick="viewImportDetails('import_20230605')">查看</button>
                            </td>
                        </tr>
                        <tr>
                            <td>2023-05-20 16:45</td>
                            <td>用户数据</td>
                            <td>users_new.csv</td>
                            <td><span style="color: #E74C3C;">失败</span></td>
                            <td>
                                <button class="action-btn" style="background-color: rgba(52, 152, 219, 0.7);" onclick="viewImportDetails('import_20230520')">查看</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        // 初始化标签页切换
        $('.tab').click(function() {
            $('.tab').removeClass('active');
            $(this).addClass('active');
            
            const tabId = $(this).data('tab');
            $('.tab-content').removeClass('active');
            $(`#${tabId}`).addClass('active');
        });
    });

    // 导出数据
    function exportData() {
        const dataType = $('#export-data-type').val();
        const format = $('#export-format').val();
        const includeImages = $('#include-images').is(':checked');
        const compress = $('#compress-export').is(':checked');
        
        // 显示加载动画
        $('body').append('<div class="loader" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000;"></div>');
        
        // 模拟导出过程
        setTimeout(function() {
            $('.loader').remove();
            
            // 构建文件名
            const date = new Date().toISOString().split('T')[0].replace(/-/g, '');
            let fileName = `export_${date}_${dataType}`;
            if (format === 'json') fileName += '.json';
            else if (format === 'csv') fileName += '.csv';
            else if (format === 'excel') fileName += '.xlsx';
            if (compress) fileName += '.zip';
            
            // 添加到导出历史
            const newRow = `
                <tr>
                    <td>${new Date().toLocaleString()}</td>
                    <td>${$('#export-data-type option:selected').text()}</td>
                    <td>${format.toUpperCase()}</td>
                    <td>3.2 MB</td>
                    <td>
                        <button class="action-btn" style="background-color: rgba(52, 152, 219, 0.7);" onclick="downloadExport('${fileName}')">下载</button>
                    </td>
                </tr>
            `;
            $('#export-history tbody').prepend(newRow);
            
            alert('数据导出成功！');
        }, 2000);
    }

    // 下载导出文件
    function downloadExport(fileName) {
        alert(`开始下载文件: ${fileName}`);
        // 这里可以添加实际的下载逻辑
    }

    // 导入数据
    function importData() {
        const dataType = $('#import-data-type').val();
        const fileInput = $('#import-file')[0];
        
        if (!fileInput.files || fileInput.files.length === 0) {
            alert('请选择要导入的文件');
            return;
        }
        
        const file = fileInput.files[0];
        const overwrite = $('#overwrite-existing').is(':checked');
        const validate = $('#validate-import').is(':checked');
        
        // 显示加载动画
        $('body').append('<div class="loader" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000;"></div>');
        
        // 模拟导入过程
        setTimeout(function() {
            $('.loader').remove();
            
            // 随机成功或失败
            const success = Math.random() > 0.3;
            
            // 添加到导入历史
            const date = new Date().toISOString().split('T')[0].replace(/-/g, '');
            const importId = `import_${date}`;
            
            const newRow = `
                <tr>
                    <td>${new Date().toLocaleString()}</td>
                    <td>${$('#import-data-type option:selected').text()}</td>
                    <td>${file.name}</td>
                    <td><span style="color: ${success ? '#2ECC71' : '#E74C3C'};">${success ? '成功' : '失败'}</span></td>
                    <td>
                        <button class="action-btn" style="background-color: rgba(52, 152, 219, 0.7);" onclick="viewImportDetails('${importId}')">查看</button>
                    </td>
                </tr>
            `;
            $('#import-history tbody').prepend(newRow);
            
            if (success) {
                alert('数据导入成功！');
            } else {
                alert('数据导入失败，请查看详情了解原因。');
            }
        }, 2000);
    }

    // 查看导入详情
    function viewImportDetails(importId) {
        // 模拟导入详情
        let details = '';
        
        if (importId === 'import_20230605') {
            details = `
                <div style="color: white;">
                    <p><strong>导入状态:</strong> <span style="color: #2ECC71;">成功</span></p>
                    <p><strong>导入时间:</strong> 2023-06-05 11:20:35</p>
                    <p><strong>数据类型:</strong> 植物数据</p>
                    <p><strong>文件名:</strong> plants_batch_2.json</p>
                    <p><strong>导入记录数:</strong> 25</p>
                    <p><strong>新增记录:</strong> 18</p>
                    <p><strong>更新记录:</strong> 7</p>
                    <p><strong>导入用户:</strong> admin</p>
                </div>
            `;
        } else if (importId === 'import_20230520') {
            details = `
                <div style="color: white;">
                    <p><strong>导入状态:</strong> <span style="color: #E74C3C;">失败</span></p>
                    <p><strong>导入时间:</strong> 2023-05-20 16:45:12</p>
                    <p><strong>数据类型:</strong> 用户数据</p>
                    <p><strong>文件名:</strong> users_new.csv</p>
                    <p><strong>错误原因:</strong> 文件格式错误，第15行缺少必要字段</p>
                    <p><strong>导入用户:</strong> admin</p>
                </div>
                <div style="margin-top: 15px; background-color: rgba(231, 76, 60, 0.1); padding: 10px; border-radius: 5px; color: #E74C3C;">
                    <p><strong>错误详情:</strong></p>
                    <pre style="margin-top: 5px; white-space: pre-wrap;">Line 15: Expected 6 columns but got 4. Missing fields: 'email', 'role'</pre>
                </div>
            `;
        } else {
            details = `
                <div style="color: white;">
                    <p><strong>导入ID:</strong> ${importId}</p>
                    <p><strong>导入时间:</strong> ${new Date().toLocaleString()}</p>
                    <p><strong>状态:</strong> 处理中</p>
                </div>
            `;
        }
        
        // 创建模态框
        $('body').append(`
            <div id="import-details-modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); z-index: 1000; display: flex; align-items: center; justify-content: center;">
                <div style="width: 80%; max-width: 600px; background-color: rgba(30, 30, 30, 0.9); backdrop-filter: blur(10px); border-radius: 10px; padding: 20px; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                        <h3 style="color: white;">导入详情</h3>
                        <button onclick="closeModal()" style="background: none; border: none; color: white; font-size: 20px; cursor: pointer;">×</button>
                    </div>
                    <div id="import-details-content">
                        ${details}
                    </div>
                </div>
            </div>
        `);
    }

    // 关闭模态框
    function closeModal() {
        $('#import-details-modal').remove();
    }
</script>

